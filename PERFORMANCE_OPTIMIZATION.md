# Оптимизация производительности VODeco

## Проблемы, которые были решены:

### 1. Проблемы с загрузкой первой страницы
- **Причина**: Множественные анимации Canvas и CSS запускались одновременно
- **Решение**: Добавлена ленивая загрузка анимаций с задержкой в 2 секунды

### 2. Проблемы с бургер меню
- **Причина**: Конфликты z-index между анимированным фоном и мобильным меню
- **Решение**: Увеличен z-index для мобильного хедера (z-[60]) и меню (z-[70])
- **Дополнительно**: Добавлено бургер меню в LandingHeader для страниц лендинг и презентация

### 3. Торможение приложения
- **Причина**: Сложные Canvas анимации работали на всех устройствах
- **Решение**: Интеллектуальное определение производительности устройства с учетом батареи и соединения

## Внесенные оптимизации:

### 1. Интеллектуальное управление анимациями
- Создан хук `usePerformance` для определения возможностей устройства
- Автоматическое отключение анимаций на слабых устройствах
- Учет настроек пользователя `prefers-reduced-motion`
- **НОВОЕ**: Учет уровня батареи и типа соединения
- **НОВОЕ**: PerformanceManager для централизованного управления

### 2. Оптимизация Canvas анимаций
- Ограничение FPS до 20 кадров в секунду (было 30)
- Рендеринг только видимых элементов
- Увеличение размера гексагонов для уменьшения их количества
- Дебаунс для обработчика изменения размера окна
- **НОВОЕ**: Увеличение расстояния между гексагонами

### 3. Статический фон для слабых устройств
- Создан компонент `StaticBackground` для устройств с низкой производительностью
- Сохранен визуальный стиль без анимаций

### 4. Оптимизация CSS анимаций
- Увеличен период анимации градиента с 20 до 60 секунд (на мобильных 120 секунд)
- Добавлена поддержка `prefers-reduced-motion`
- **НОВОЕ**: Адаптивная скорость анимации для мобильных устройств

### 5. Оптимизация Framer Motion
- Использование `useReducedMotion` для отключения анимаций
- Упрощение анимаций на слабых устройствах

### 6. Оптимизация 3D компонентов
- **НОВОЕ**: Ограничение FPS глобуса до 30 кадров в секунду
- **НОВОЕ**: Упрощение анимации маркеров (обновление каждый 3-й кадр)
- **НОВОЕ**: Замедление вращения облаков
- **НОВОЕ**: Уменьшение амплитуды пульсации маркеров

### 7. Пользовательский контроль
- **НОВОЕ**: PerformanceToggle для ручного переключения режима производительности
- **НОВОЕ**: Индикатор батареи и типа соединения
- **НОВОЕ**: Визуальные индикаторы состояния производительности

## Критерии определения слабых устройств:

1. **Количество ядер процессора** ≤ 2
2. **Объем памяти** ≤ 2GB
3. **Размер экрана** < 1,000,000 пикселей
4. **Отсутствие WebGL** поддержки
5. **Тип соединения** slow-2g, 2g, 3g
6. **Уровень батареи** < 20%

## Результаты оптимизации:

- ✅ Быстрая загрузка первой страницы
- ✅ Работающее бургер меню на всех устройствах (включая лендинг и презентацию)
- ✅ Плавная работа на слабых устройствах
- ✅ Сохранение визуального эффекта на мощных устройствах
- ✅ Автоматическая адаптация к настройкам пользователя
- ✅ **НОВОЕ**: Учет уровня батареи и типа соединения
- ✅ **НОВОЕ**: Ручное управление производительностью
- ✅ **НОВОЕ**: Визуальные индикаторы состояния системы

## Дополнительные рекомендации:

1. **Мониторинг производительности**: Используйте DevTools для отслеживания FPS
2. **Тестирование на слабых устройствах**: Проверяйте на старых смартфонах
3. **Настройки пользователя**: Всегда учитывайте `prefers-reduced-motion`
4. **Ленивая загрузка**: Загружайте тяжелые компоненты только при необходимости

## Файлы, которые были изменены:

### Модифицированные файлы:
- `client/src/components/layout/BackgroundProvider.tsx` - Основной провайдер фона
- `client/src/components/layout/HexOceanWaves.tsx` - Анимированные волны
- `client/src/components/layout/AnimatedHexGrid.tsx` - Анимированная сетка
- `client/src/components/layout/MobileHeader.tsx` - Мобильный хедер
- `client/src/components/layout/LandingHeader.tsx` - Хедер для лендинга (добавлено бургер меню)
- `client/src/components/layout/Header.tsx` - Основной хедер (добавлен PerformanceToggle)
- `client/src/pages/LandingPage.tsx` - Главная страница
- `client/src/index.css` - CSS анимации
- `client/src/hooks/use-performance.ts` - Хук для производительности (расширен)
- `client/src/components/globo/EarthGlobe.tsx` - 3D глобус (оптимизирован)
- `client/src/App.tsx` - Основное приложение (добавлен PerformanceIndicator)

### Новые файлы:
- `client/src/components/layout/StaticBackground.tsx` - Статический фон
- `client/src/components/layout/PerformanceManager.tsx` - Менеджер производительности
- `client/src/components/ui/PerformanceToggle.tsx` - Переключатель производительности
